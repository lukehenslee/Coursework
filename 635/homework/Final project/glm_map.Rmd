---
title: "Final project "
author: "Luke Henslee"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
---

```{r, include=FALSE, results=FALSE}

library(ggpubr)
library(forcats)
library(ggforce)
library(lubridate)
library(RColorBrewer)
library(viridis)
library(tidyverse)
library(ggplot2)
library(bbmle)
library(dplyr)
library(manipulate)
library(visreg) 
library(ggridges)
library(reshape2)
library(cowplot)
library(ggmap)
library(ggspatial)
library(sf)
library(spData)
library(ggsn)
library(extrafont)
loadfonts(device = "win")

```

### Figure 1  

#### 1) Import data   

```{r}
setwd("C:/Users/lukeh/Desktop/Grad School/Coursework/635/data")

mcode <- read.csv("M_code_list.csv")
```

#### 2) Subset data
```{r}
# Subset data to fish assigned to stocks
stocks <- filter(mcode, mcode$Spawning.group %in% c("4", "5", "6", "S"))
```

### Figure 4

#### 1) Creat glm
```{r}
# Create binomial response for terminal stocks in Shaktoolik subdistrict
stocks5 <- filter(stocks, stocks$Tag.group == 2)

# Creat bionmial response column 
bi <- vector(length = nrow(stocks5))

for(i in 1:length(bi)) {
  if(stocks5[i,9] == stocks5[i,16]) {
    bi[i] <- 1
  } else {
    bi[i] <- 0
  }
}

stocks5$binomial <- bi

# Build model
bi_model <- glm(binomial ~ Lat + Long, data = stocks5,
                  family = binomial(link = "logit"))
```

#### 2) Generate predictions
```{r}
# Import coordinates from shoreline of SD5
pred.coords <- as.vector(c(-160.9505401272465,64.13561160564406,-160.9482866203195,64.1434881423708,-160.9480757786045,64.14785616503299,-160.9459256773437,64.15133978930778,-160.9417775287547,64.15480865430797,-160.9416807056774,64.15831427853887,-160.9415095246948,64.16268832579692,-160.9413260661951,64.16793832694967,-160.9412367793406,64.17056283525145,-160.9411649134314,64.17406412078368,-160.942989294341,64.17757433724086,-160.9446282997591,64.18283210120917,-160.944426956191,64.18807994680873,-160.9462607332977,64.19246879218618,-160.9481215491512,64.19598299951397,-160.94780267169,64.20298158665632,-160.9534233855457,64.21178186299362,-160.9552878573058,64.21529737860887,-160.9611716092334,64.21884505096519,-160.9650135227999,64.22325104478695,-160.9708991180906,64.22679927955919,-160.978723518117,64.23211391231848,-160.9805891997385,64.23563138141519,-160.9884647685729,64.24006758319857,-160.9943637749521,64.24361346882579,-160.9982504815298,64.24714408537915,-161.0021395904364,64.25067414352881,-161.010057988909,64.2542344497887,-161.0179760588962,64.25779594365004,-161.0179415975776,64.2586709356701,-161.0258292152872,64.26310508629314,-161.037579638709,64.27194490172738,-161.0454734111278,64.27637939219304,-161.051420567104,64.27904875833055,-161.059318934616,64.2834830090605,-161.0672516332845,64.28704130098471,-161.0711546854787,64.29056986143947,-161.0770749922548,64.29411364371448,-161.08498179662,64.29854670675209,-161.090905606442,64.30209003530423,-161.0968631585915,64.30475801999971,-161.1048084525591,64.30831567630716,-161.1127563215217,64.31187031873175,-161.1206743888992,64.31630280006685,-161.1286266782213,64.31985854607562,-161.1366120196489,64.32253894689586,-161.1445378256123,64.32696977882708,-161.1544267413745,64.33316436701998,-161.1604303766203,64.33583072704208,-161.1663405742782,64.33937387630917,-161.1743362820685,64.34205394393244,-161.1822459951527,64.34736110559722,-161.1881950861573,64.35090350123753,-161.1961387097681,64.35533362945841,-161.2000974178006,64.35798639811721,-161.208102809335,64.36066403545207,-161.2140613305604,64.3642032165659,-161.2200438272874,64.36686814551756,-161.2260021141186,64.37040678572694,-161.2319896640668,64.37306951451039,-161.2399758242159,64.37662551710429,-161.2459709060147,64.37928687706876,-161.2499370077104,64.38193975115402,-161.2659800171016,64.38729735276448,-161.2719762668671,64.38996207236296,-161.2800276532803,64.39175608998445,-161.2921052993336,64.39446245539465,-161.3001338884626,64.39713494848084,-161.3101911333028,64.39982092396681,-161.3182484017186,64.40161876194685,-161.3263299452601,64.40253958744611,-161.3364179581324,64.40434489953532,-161.3424516991496,64.40613073952294,-161.3505122214923,64.40792931677134,-161.3606014905671,64.40973145337799,-161.3686447229823,64.41240692542266,-161.3787155556603,64.41509255977616,-161.3867903686745,64.41688573904824,-161.3948618275406,64.41868205328204,-161.4029283735232,64.42047526368017,-161.4110210636542,64.4213924776696,-161.4211415202853,64.42231590559432,-161.4312825056133,64.42236199677987,-161.4373670042844,64.42238926817018,-161.4455046388348,64.42155186133168,-161.453606130705,64.41979768964646,-161.4596948712249,64.4180451279753,-161.4699402784765,64.41460720984308,-161.4781696514101,64.41116741192113,-161.4863987533427,64.40772631719167,-161.4925083348042,64.40332893690929,-161.4966012986987,64.39893236195805,-161.5007260644263,64.39455801259808,-161.5069407040222,64.38845640400224,-161.5130027191569,64.38581668148569,-161.5191306785274,64.38232866605404,-161.5273858783621,64.37890548925608,-161.5294332548511,64.37892501862646 
))

long <- pred.coords[c(TRUE,FALSE)]

lat <- pred.coords[c(F, T)]


# Predict model output values and create dataframe
pred <- predict(bi_model, data.frame(Lat = lat, Long = long),
                  type = "response")
pred
pred.data <- data.frame(cbind(lat, long, pred))
pred.data
```

#### 3) Create basemap
```{r}
SD5 <- get_map(location=c(-161.6, 64.1,-160.85, 64.5),
                maptype='toner-lite',source='stamen',crop=TRUE) 

ggmap(SD5) +
        geom_point(data = pred.data, aes(x=long, 
                       y=lat, color = pred), alpha = 0.5, size = 3) +
  scale_color_viridis(discrete = F, option = "C") +
  xlab(NULL) + ylab(NULL) +
  annotation_north_arrow(style = north_arrow_nautical()) + 
  coord_sf(crs = 4326) + 
  annotation_scale(style = "ticks", location = "br", height = unit(2, "mm"), 
                   tick_height = 1, text_cex = 1, line_width = 2) +
  theme(axis.title.y = element_text(size = 14, margin = margin(t = 0, r = 10, b = 0, l = 0), colour = "black"),
        axis.title.x = element_text(size = 14, margin = margin(t = 0, r = 0, b = 0, l = 0), colour = "black"),
        text = element_text(family = "Times New Roman")) +
  theme (panel.border = element_rect (fill = "transparent", color = "grey20", size = 2)) +
  theme (plot.margin = unit(c(0,0,.5,0), "cm"))


```

